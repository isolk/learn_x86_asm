8259芯片提供中断访问管理

有两个芯片，每个8个引脚，分为主和从。主从级联。主芯片连接CPU。

中断从引脚输入。

主芯片0引脚接定时器，从芯片0引脚接时钟芯片

每个芯片内部都有个8位寄存器，每一位的值都决定对应位引脚的中断能否达到cpu，0表示可以。

8259可编程，主芯片2个端口号为，0x20，0x21。从芯片端口号为，0xa0，0xa1

cpu根据IF标志位来决定是否处理中断，0忽略，1处理。cli，置0。sli，置1。

cpu支持256个中断
> why?可能随便规定的。

8259提供15个中断，这15个中断有自己的默认中断号，可以改变，但没必要。

实模式下，物理内存的0x00000~0x003ff存放中断向量表。
> 中断向量表就是一系列映射，映射端口号和对应中断处理程序的偏移地址+代码段地址。

主芯片中断号 0x08开始，从芯片 0x70开始

0-1字节放偏移地址，2-3放段地址。

不可屏蔽中断的中断号是2

中断向量表初始化工作由BIOS完成，默认情况下处理程序就是返回指令。

cpu收到中断时，会压栈，禁掉IF防止再次收到中断，根据中断号跳转，执行指令，跳转，恢复栈。

自己编写的中断处理程序必须最后必须调用iret指令来完成跳转和恢复栈的工作。

要编写自己的中断处理程序，只需修改端口号对应的程序地址即可。

时钟芯片连接中断器的从片0引脚，提供时间和闹钟功能。

时钟芯片依靠32768HZ的振荡器经过分频，生成每一次的状态刷新。

时间信息保存在cmoss中。

### cmoss
cmoss断电数据会消失，但是主板一般集成小的电池持续供电，保证不断电。

cmoss有64-128-256字节，其他保存密码，开机顺序等其他信息，由BIOS负责修改。

comoss的内存也可以访问，端口号为（0x70，0x71）、（0x74，0x75）。左为索引，传偏移地址，右为数据端口。

端口号0x70的最高位略有特殊，第7位为1时，忽略所有NMI信号。只有0-6位用于索引地址。

bcb编码，4位表示一个十进制数的位。

时间等信息默认以bcd编码。

### rtc
rtc相关数据在cmoss的0x00-0xd中。

0x00-0x09 放相关时间，依次是:
0x0a-0x0d 放4个寄存器，用于设置rtc的工作方式以及当前rtc的状态标志

c寄存器保存中断原因标志。

c寄存器状态读取则自动清零，如果不读，不会再触发相同中断

### 8259
8259默认情况下的rtc中断是不允许的，需要手动开启。

访问IMR，一个8位寄存器，然后将位0-连接RTC，设为0然后写回。
> 访问0xa1接口读即可

hlt可以暂停cpu执行，发生中断后恢复。

test命令会按位与，修改状态寄存器，不改值。

resb 可以保留一定字节数

向0xa0 和20端口发送0x20以结束中断标志。